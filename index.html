<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Job Khojo | Find Your Perfect Job</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Poppins", sans-serif;
        background: linear-gradient(135deg, #4f46e5, #9333ea);
        color: white;
      }
      .hidden {
        display: none;
      }
      .active-step {
        background-color: #22c55e !important;
      }
      .tag {
        background-color: #22c55e;
        color: white;
        padding: 5px 10px;
        border-radius: 9999px;
        margin: 5px;
        display: inline-block;
        cursor: pointer;
      }
    </style>
  </head>

  <body class="flex items-center justify-center min-h-screen">
    <div
      class="w-full max-w-2xl bg-white/10 backdrop-blur-md p-8 rounded-2xl shadow-2xl"
    >
      <h1 class="text-4xl font-bold text-center mb-2 text-yellow-300">
        Job Khojo üíº
      </h1>
      <p class="text-center text-sm text-gray-200 mb-6">
        Find your dream job effortlessly
      </p>

      <!-- Progress Bar -->
      <div class="flex justify-between mb-8">
        <div
          id="stepIndicator1"
          class="w-8 h-8 rounded-full bg-gray-400 flex items-center justify-center active-step"
        >
          1
        </div>
        <div
          id="stepIndicator2"
          class="w-8 h-8 rounded-full bg-gray-400 flex items-center justify-center"
        >
          2
        </div>
        <div
          id="stepIndicator3"
          class="w-8 h-8 rounded-full bg-gray-400 flex items-center justify-center"
        >
          3
        </div>
      </div>

      <!-- STEP 1 -->
      <form id="step1" class="space-y-4" onsubmit="nextStep(event, 1)">
        <h2 class="text-2xl font-semibold text-center mb-4">
          Step 1 of 3 ‚Äì Personal Information
        </h2>

        <input type="text" id="fullName" placeholder="Full Name" required class="w-full p-3 rounded-md text-black" />
        <input type="email" id="email" placeholder="Email Address" required class="w-full p-3 rounded-md text-black" />
        <input type="tel" id="phone" placeholder="Phone Number" required class="w-full p-3 rounded-md text-black" />
        <input type="text" id="city" placeholder="City" required class="w-full p-3 rounded-md text-black" />

        <select id="state" required class="w-full p-3 rounded-md text-black">
          <option value="">Select State</option>
          <option>Bihar</option>
          <option>Delhi (NCT)</option>
          <option>Maharashtra</option>
          <option>Tamil Nadu</option>
          <option>West Bengal</option>
          <option>Uttar Pradesh</option>
          <option>Other</option>
        </select>

        <select id="country" required class="w-full p-3 rounded-md text-black">
          <option value="">Select Country</option>
          <option>India</option>
          <option>Nepal</option>
          <option>Bangladesh</option>
          <option>Other</option>
        </select>

        <button
          type="submit"
          class="w-full bg-yellow-400 text-black p-3 rounded-md font-semibold hover:bg-yellow-300"
        >
          Next ‚Üí Job Preferences
        </button>
      </form>

      <!-- STEP 2 -->
      <form id="step2" class="space-y-4 hidden" onsubmit="nextStep(event, 2)">
        <h2 class="text-2xl font-semibold text-center mb-4">
          Step 2 of 3 ‚Äì Job Preferences
        </h2>

        <input type="text" id="jobTitle" placeholder="Desired Job Title / Role" required class="w-full p-3 rounded-md text-black" />
        <select id="jobType" required class="w-full p-3 rounded-md text-black">
          <option value="">Preferred Job Type</option>
          <option>Full-time</option>
          <option>Part-time</option>
          <option>Remote</option>
          <option>Hybrid</option>
          <option>Internship</option>
        </select>
        <select id="experience" required class="w-full p-3 rounded-md text-black">
          <option value="">Experience Level</option>
          <option>Fresher</option>
          <option>1‚Äì3 Years</option>
          <option>3‚Äì5 Years</option>
          <option>5‚Äì8 Years</option>
          <option>8+ Years</option>
        </select>
        <select id="salary" required class="w-full p-3 rounded-md text-black">
          <option value="">Expected Salary (Per Year)</option>
          <option>Below ‚Çπ3 LPA</option>
          <option>‚Çπ3‚Äì5 LPA</option>
          <option>‚Çπ5‚Äì8 LPA</option>
          <option>‚Çπ8‚Äì12 LPA</option>
          <option>‚Çπ12‚Äì20 LPA</option>
          <option>Above ‚Çπ20 LPA</option>
        </select>
        <select id="industry" required class="w-full p-3 rounded-md text-black" onchange="loadSkills()">
          <option value="">Preferred Industry</option>
          <option>Information Technology</option>
          <option>Finance</option>
          <option>Healthcare</option>
          <option>Marketing</option>
          <option>Education</option>
          <option>E-commerce</option>
        </select>

        <!-- Willing to Relocate (optional) -->
        <label class="block">
          <input type="checkbox" id="relocate" class="mr-2" />
          I am willing to relocate (optional)
        </label>

        <button
          type="submit"
          class="w-full bg-yellow-400 text-black p-3 rounded-md font-semibold hover:bg-yellow-300"
        >
          Next ‚Üí Skills & Resume
        </button>
      </form>

      <!-- STEP 3 -->
      <form id="step3" class="space-y-4 hidden" onsubmit="submitToBackend(event)">
        <h2 class="text-2xl font-semibold text-center mb-4">
          Step 3 of 3 ‚Äì Skills & Resume Upload
        </h2>

        <label class="block mb-2 text-sm">Select Your Primary Skills</label>
        <div id="skillsContainer" class="flex flex-wrap mb-3"></div>

        <!-- Manual skill (optional now) -->
        <input
          type="text"
          id="manualSkill"
          placeholder="Add a skill and press Enter (optional)"
          class="w-full p-3 rounded-md text-black"
          onkeydown="addManualSkill(event)"
        />

        <label class="block mt-4 mb-2 text-sm">Upload Your Resume</label>
        <input
          type="file"
          id="resume"
          accept=".pdf,.doc,.docx"
          required
          class="w-full p-3 rounded-md text-black"
        />

        <button
          type="submit"
          id="submitBtn"
          class="w-full bg-green-500 text-white p-3 rounded-md font-semibold hover:bg-green-400"
        >
          Submit ‚Üí Find Jobs
        </button>

        <p id="loadingMsg" class="hidden text-center text-yellow-300 mt-3">‚è≥ Submitting... please wait</p>
      </form>

      <!-- ‚úÖ SUCCESS SCREEN -->
      <div id="successScreen" class="hidden text-center space-y-6">
        <h2 class="text-3xl font-bold text-green-400 animate-bounce">
          üéâ Congratulations!
        </h2>
        <p class="text-lg text-gray-100">
          Your details have been submitted successfully to
          <span class="text-yellow-300 font-semibold">Job Khojo</span>.
        </p>
        <p class="text-md text-gray-200">
          Kindly check your registered email for personalized job matches.
        </p>

        <div class="mt-6 bg-white/10 backdrop-blur-md rounded-xl p-6 shadow-lg">
          <p class="italic text-lg text-gray-100">
            ‚ÄúThe future depends on what you do today.‚Äù
          </p>
          <p class="text-sm text-gray-300 mt-2">‚Äî Mahatma Gandhi</p>
        </div>
      </div>
    </div>

    <script>
      // Navigation
      function nextStep(event, step) {
        event.preventDefault();
        document.getElementById(`step${step}`).classList.add("hidden");
        document.getElementById(`step${step + 1}`).classList.remove("hidden");
        document.getElementById(`stepIndicator${step}`).classList.remove("active-step");
        document.getElementById(`stepIndicator${step + 1}`).classList.add("active-step");
      }

      // Load skills dynamically
      const industrySkills = {
        "Information Technology": ["Python", "React", "Node.js", "SQL", "AWS"],
        Finance: ["Tally", "Excel", "Accounting", "Taxation"],
        Healthcare: ["Clinical Data", "Patient Care", "Medical Coding"],
        Marketing: ["SEO", "Social Media", "Content Writing"],
        Education: ["Teaching", "Research", "Curriculum Design"],
        "E-commerce": ["Inventory", "Product Listing", "SEO"],
      };

      function loadSkills() {
        const industry = document.getElementById("industry").value;
        const container = document.getElementById("skillsContainer");
        container.innerHTML = "";
        if (industrySkills[industry]) {
          industrySkills[industry].forEach((skill) => {
            const tag = document.createElement("span");
            tag.textContent = skill;
            tag.classList.add("tag");
            tag.onclick = () => tag.classList.toggle("bg-gray-500");
            container.appendChild(tag);
          });
        }
      }

      function addManualSkill(e) {
        if (e.key === "Enter") {
          e.preventDefault();
          const input = document.getElementById("manualSkill");
          const skill = input.value.trim();
          if (skill) {
            const tag = document.createElement("span");
            tag.textContent = skill;
            tag.classList.add("tag");
            document.getElementById("skillsContainer").appendChild(tag);
            input.value = "";
          }
        }
      }

      // Submit to backend
      async function submitToBackend(event) {
        event.preventDefault();
        const btn = document.getElementById("submitBtn");
        const loading = document.getElementById("loadingMsg");
        btn.disabled = true;
        loading.classList.remove("hidden");

        const formData = new FormData();
        [
          "fullName","email","phone","city","state","country",
          "jobTitle","jobType","experience","salary","industry","shift"
        ].forEach(id => formData.append(id, document.getElementById(id).value));

        const relocate = document.getElementById("relocate").checked ? "on" : "off";
        formData.append("relocate", relocate);

        const tags = Array.from(document.querySelectorAll("#skillsContainer .tag"));
        const skills = tags.map(t => t.textContent).join(", ");
        formData.append("skills", skills);

        const resumeFile = document.getElementById("resume").files[0];
        if (resumeFile) formData.append("resume", resumeFile);

        try {
          const response = await fetch("https://job-search-engine-backend.onrender.com/api/jobform", {
            method: "POST",
            body: formData
          });
          const result = await response.json();
          if (result.status === "success") {
            document.getElementById("step3").classList.add("hidden");
            document.getElementById("successScreen").classList.remove("hidden");
          } else {
            alert("‚ö†Ô∏è Backend error: " + (result.error || result.message));
          }
        } catch (error) {
          console.error(error);
          alert("‚ö†Ô∏è Could not reach backend.");
        } finally {
          btn.disabled = false;
          loading.classList.add("hidden");
        }
      }
    </script>
  </body>
</html>
